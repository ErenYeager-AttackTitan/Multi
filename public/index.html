<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MP4 to HLS Converter</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    #progress { margin-top: 10px; width: 100%; background: #ccc; height: 10px; position: relative; }
    #bar { height: 10px; width: 0%; background: green; transition: width 0.3s; }
  </style>
</head>
<body>
  <h2>Upload MP4 to convert to Adaptive HLS</h2>
  <form id="uploadForm">
    <input type="file" name="video" accept="video/mp4" required /><br><br>
    <button type="submit">Upload & Convert</button>
  </form>
  <div id="progress"><div id="bar"></div></div>
  <p id="status"></p>
  <p id="link"></p>

  <script>
    const form = document.getElementById("uploadForm");
    const bar = document.getElementById("bar");
    const status = document.getElementById("status");
    const link = document.getElementById("link");

    form.onsubmit = async (e) => {
      e.preventDefault();
      const data = new FormData(form);
      const xhr = new XMLHttpRequest();

      xhr.open("POST", "/convert", true);
      xhr.upload.onprogress = (e) => {
        const percent = (e.loaded / e.total) * 100;
        bar.style.width = percent + "%";
        status.innerText = `Uploading: ${Math.round(percent)}%`;
      };

      xhr.onload = () => {
        const res = JSON.parse(xhr.responseText);
        status.innerText = "Conversion complete!";
        link.innerHTML = `M3U8 URL: <a href="${res.url}" target="_blank">${res.url}</a>`;
      };

      xhr.onerror = () => {
        status.innerText = "Upload failed.";
      };

      xhr.send(data);
    };
  </script>
</body>
</html>
